#!/bin/sh

if ! command -v makepkg &>/dev/null; then
    echo 1>&2 'makepkg not installed. Aborting.'
    exit 1
fi

if ! command -v wget &>/dev/null; then
    echo 1>&2 'wget not installed. Aborting.'
    exit 1
fi

install=0
force=0
quiet=0
package=

while [[ $# > 0 ]]
do
    key=$1
    case $key in
        -q|--quiet)
            quiet=1
            ;;
        -f|--force)
            force=1
            ;;
        -i|--install)
            install=1
            ;;
        *)
            package=$1
            ;;
    esac
    shift
done

DIR=~/src/aur
[ ! -d $DIR ] && mkdir -p $DIR
cd $DIR

url=https://aur.archlinux.org/packages/${package:0:2}/$package/$package.tar.gz

if pacman -Q "$package" >/dev/null; then
    if [ $force -ne 1 ]; then
        if [ $quiet -ne 1 ]; then
            echo "Looks like $package is already installed."
            echo 'Use --force to reinstall.'
        fi
        exit 1
    fi
fi

wget "$url" -qO- | tar xz || { echo "Package $package not found!"; exit 1; }
if [ $install -eq 1 ]; then
    cd "$package"
    makepkg -i
fi
